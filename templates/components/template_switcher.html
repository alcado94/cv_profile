<!-- Template Switcher Component - Navegación flotante entre templates -->
<nav class="template-switcher" aria-label="Template selector">
  <button class="template-switcher-button" aria-label="Change template" title="Switch template" id="templateSwitcherBtn">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path d="M4 7h16M4 12h16M4 17h16"/>
    </svg>
  </button>
  
  <div class="template-switcher-menu" id="templateSwitcherMenu">
    <ul class="template-switcher-list" id="templateSwitcherList">
      <!-- Generated by JavaScript -->
    </ul>
  </div>
</nav>

<style>
  /* CSS Variables - Paleta minimalista monocromática */
  :root {
    --switcher-bg: rgba(255, 255, 255, 0.95);
    --switcher-text: #18181b;
    --switcher-text-secondary: #71717a;
    --switcher-border: rgba(0, 0, 0, 0.06);
    --switcher-hover: rgba(0, 0, 0, 0.04);
    --switcher-active: rgba(0, 0, 0, 0.08);
    --switcher-shadow: rgba(0, 0, 0, 0.03);
    --switcher-dot: #18181b;
  }

  /* Contenedor principal */
  .template-switcher {
    position: fixed;
    bottom: 24px;
    right: 24px;
    z-index: 9999;
    font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', sans-serif;
  }

  /* Botón minimalista */
  .template-switcher-button {
    width: 44px;
    height: 44px;
    border-radius: 12px;
    background: var(--switcher-bg);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    color: var(--switcher-text);
    border: 1px solid var(--switcher-border);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 1px 3px var(--switcher-shadow);
    transition: all 0.2s ease;
    outline: none;
  }

  .template-switcher-button:hover {
    background: rgba(255, 255, 255, 1);
    border-color: rgba(0, 0, 0, 0.1);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    transform: translateY(-1px);
  }

  .template-switcher-button:active {
    transform: translateY(0);
    box-shadow: 0 1px 3px var(--switcher-shadow);
  }

  .template-switcher-button svg {
    width: 18px;
    height: 18px;
    opacity: 0.7;
  }

  /* Menú desplegable ultra minimalista */
  .template-switcher-menu {
    position: absolute;
    bottom: 54px;
    right: 0;
    background: var(--switcher-bg);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border: 1px solid var(--switcher-border);
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    min-width: 180px;
    opacity: 0;
    visibility: hidden;
    transform: translateY(8px) scale(0.96);
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: hidden;
  }

  .template-switcher-menu.show {
    opacity: 1;
    visibility: visible;
    transform: translateY(0) scale(1);
  }

  /* Lista sin decoraciones */
  .template-switcher-list {
    list-style: none;
    margin: 0;
    padding: 6px;
  }

  /* Items ultra clean */
  .template-switcher-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 12px;
    color: var(--switcher-text);
    text-decoration: none;
    font-size: 14px;
    font-weight: 400;
    border-radius: 8px;
    transition: all 0.15s ease;
    cursor: pointer;
    position: relative;
  }

  .template-switcher-item:hover {
    background: var(--switcher-hover);
    color: var(--switcher-text);
  }

  /* Estado activo ultra minimalista */
  .template-switcher-item.active {
    color: var(--switcher-text);
    font-weight: 500;
    background: var(--switcher-active);
  }

  .template-switcher-item.active::after {
    content: '';
    width: 5px;
    height: 5px;
    border-radius: 50%;
    background: var(--switcher-dot);
    flex-shrink: 0;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .template-switcher {
      bottom: 20px;
      right: 20px;
    }

    .template-switcher-button {
      width: 40px;
      height: 40px;
    }

    .template-switcher-button svg {
      width: 16px;
      height: 16px;
    }

    .template-switcher-menu {
      min-width: 160px;
      bottom: 50px;
    }

    .template-switcher-item {
      font-size: 13px;
      padding: 9px 11px;
    }
  }

  /* Print */
  @media print {
    .template-switcher {
      display: none !important;
    }
  }

  /* Dark mode support (opcional) */
  @media (prefers-color-scheme: dark) {
    :root {
      --switcher-bg: rgba(24, 24, 27, 0.95);
      --switcher-text: #fafafa;
      --switcher-text-secondary: #a1a1aa;
      --switcher-border: rgba(255, 255, 255, 0.08);
      --switcher-hover: rgba(255, 255, 255, 0.06);
      --switcher-active: rgba(255, 255, 255, 0.12);
      --switcher-shadow: rgba(0, 0, 0, 0.3);
      --switcher-dot: #fafafa;
    }
  }
</style>

<script>
(function() {
  'use strict';

  // Configuración de templates disponibles
  const TEMPLATES = {{ templates_switcher | default([]) | tojson }};

  // Elementos del DOM
  const button = document.getElementById('templateSwitcherBtn');
  const menu = document.getElementById('templateSwitcherMenu');
  const list = document.getElementById('templateSwitcherList');

  // Estado del menú
  let isMenuOpen = false;

  /**
   * Detecta el template actual desde la URL
   * @returns {string} Nombre del archivo del template actual
   */
  function getCurrentTemplate() {
    if (!TEMPLATES.length) {
      return '';
    }

    const path = window.location.pathname;
    let filename = path.split('/').pop();
    if (!filename) {
      filename = 'index.html';
    }
    
    // Si el filename está en nuestra lista de templates, devolverlo
    const template = TEMPLATES.find(t => t.output === filename);
    if (template) {
      return filename;
    }
    
    // Por defecto, retornar el primero (Modern CV)
    return TEMPLATES[0].output;
  }

  /**
   * Construye la URL para un template específico
   * @param {string} filename - Nombre del archivo del template
   * @returns {string} URL completa
   */
  function buildTemplateURL(filename) {
    const path = window.location.pathname;
    const pathParts = path.split('/');
    
    // Reemplazar el último segmento (nombre del archivo) con el nuevo filename
    pathParts[pathParts.length - 1] = filename;
    
    return pathParts.join('/');
  }

  /**
   * Renderiza la lista de templates en el menú
   */
  function renderTemplateList() {
    if (!TEMPLATES.length) {
      return;
    }

    const currentTemplate = getCurrentTemplate();
    
    list.innerHTML = '';
    
    TEMPLATES.forEach(template => {
      const li = document.createElement('li');
      const link = document.createElement('a');
      
      link.href = buildTemplateURL(template.output);
      link.textContent = template.name;
      link.className = 'template-switcher-item';
      
      // Marcar como activo si es el template actual
      if (template.output === currentTemplate) {
        link.classList.add('active');
        link.setAttribute('aria-current', 'page');
      }
      
      li.appendChild(link);
      list.appendChild(li);
    });
  }

  /**
   * Toggle del menú (abrir/cerrar)
   */
  function toggleMenu() {
    isMenuOpen = !isMenuOpen;
    
    if (isMenuOpen) {
      menu.classList.add('show');
      button.setAttribute('aria-expanded', 'true');
    } else {
      menu.classList.remove('show');
      button.setAttribute('aria-expanded', 'false');
    }
  }

  /**
   * Cierra el menú
   */
  function closeMenu() {
    if (isMenuOpen) {
      isMenuOpen = false;
      menu.classList.remove('show');
      button.setAttribute('aria-expanded', 'false');
    }
  }

  /**
   * Maneja clicks fuera del componente para cerrar el menú
   */
  function handleClickOutside(event) {
    const switcher = document.querySelector('.template-switcher');
    
    if (switcher && !switcher.contains(event.target)) {
      closeMenu();
    }
  }

  /**
   * Maneja la tecla Escape para cerrar el menú
   */
  function handleEscapeKey(event) {
    if (event.key === 'Escape' && isMenuOpen) {
      closeMenu();
      button.focus();
    }
  }

  // Event Listeners
  button.addEventListener('click', toggleMenu);
  document.addEventListener('click', handleClickOutside);
  document.addEventListener('keydown', handleEscapeKey);

  // Inicialización
  renderTemplateList();
  
  // Configurar atributos ARIA iniciales
  button.setAttribute('aria-expanded', 'false');
  button.setAttribute('aria-haspopup', 'true');

})();
</script>
